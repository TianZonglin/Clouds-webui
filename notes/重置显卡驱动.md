---
date: 2021-6-29
categories: Daily_Life
tags:
  - Ubuntu
  - QQ
comments: true
title: 借助VSCode在Ubuntu上使用QQ
---



可以确定的经验：

- 升级内核后进入不了系统、黑屏不要着急，更不需要重装系统。只需要重装显卡驱动。
- 开机进入recovery模式内，可完成旧驱动卸载、新驱动安装等一系列操作。
- 本人机器上，使用桌面的软件更新中的Nvidia显卡，安装后无法进入系统。
- 本人机器上，直接使用Cuda默认绑定的显卡安装包，可完美安装显卡驱动。
- 本人机器上，Nvidia-410经测试无法正常安装，但450版本以上正常安装。
- 进入安装界面时Nouveau必须在禁用状态，lsmod | grep nouveau 应该无输出（如果有，则表明Nouveau依然被载入且运行，此时无法通过Nvidia驱动安装程序的检查，从而导致安装进程终止）
- 如何禁用？首先可以在 /etc/modprobe.d/blacklist.conf 中添加 blacklist nouveau；options nouveau modeset=0，然后执行 sudo update-initramfs -u 注意：此步骤可省略。当第一次运行Nvidia驱动安装程序时，如果Nouveau并未被禁用，则安装程序会在上述目录自动生成一个conf文件，内容和我们自己写的一样。并且会提示我们reboot，以让写入的conf文件生效。
- 其次，在开机后的grub页面，no splash 后面紧跟插入 nomodset，再重新进入启动流程。
- 再次，手动关闭桌面显示。service lightdm stop 或者 service gdm stop
- 注意：此时要 Ctrl+Alt+F3 进入tty来执行后续操作及安装过程。
- 最后，验证的方法就是 lsmod | grep nouveau 没有任何输出！

- 对于执行cuda绑定的驱动程序来说，无需附加诸如 -no-x-check 之类的参数，这些参数只有在直接通过Nvidia驱动安装程序安装时才可以追加。我们这里是Cuda的安装中附带安装Nvidia驱动！
- Nvidia-470 版本及以上，不包括i386的程序库支持，也就是说某些使用32位程序库的第三方软件（比如CNCNet），无法在Nvidia-470驱动上工作，会报错：libGL error: No matching fbConfigs or visuals found。这时只能从新安装低版本的驱动，比如我现在使用Nvidia-450，CNCNet完美运行。

- 安装过程中出现错误不要紧，留意错误下方的日志路径，在Cuda安装过程中，问题几乎就出在显卡驱动的安装上，而Nvidia驱动安装出现的错误会在 /var/log/nvidia-installer.log 中，查看会发现错误非常单一，基本上就是Nouveau并未被禁止，或者是nvidia-drm正在运行。前者的解决方案在上面，对于后者，通常是Nvidia驱动没卸载干净所致，所以要充分的卸载。

sudo apt-get --purge remove nvidia*
sudo apt autoremove
sudo apt-get --purge remove "*cublas*" "cuda*"
sudo apt-get --purge remove "*nvidia*"  //有点重复，不影响

如果仍然存在nvidia-drm错误，那么执行以下命令（此时应该在停用lightdm或gdm之后的tty中）

systemctl isolate multi-user.target
modprobe -r nvidia-drm

第一条命令执行完毕后会跳出tty进入黑屏，此时只需重新进入tty即可。


参考

- How to disable Nouveau kernel driver https://askubuntu.com/questions/841876/how-to-disable-nouveau-kernel-driver
- System Isolation Failed https://bbs.archlinux.org/viewtopic.php?id=228445
- How to unload kernel module 'nvidia-drm'? https://unix.stackexchange.com/questions/440840/how-to-unload-kernel-module-nvidia-drm
- Ubuntu uninstall the Nvidia driver and install the latest driver https://www.programmersought.com/article/38077690789/
- libGL error: No matching fbConfigs or visuals found libGL error: failed to load driver: swrast https://askubuntu.com/questions/834254/steam-libgl-error-no-matching-fbconfigs-or-visuals-found-libgl-error-failed-t/903488#903488
- Nvidia drivers without 32 bit library https://github.com/ValveSoftware/steam-for-linux/issues/7901
